<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor | ToolKitPro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Previous CSS remains the same, just adding these new styles */
        
        /* Upload success animation */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .upload-success {
            color: var(--success);
            font-weight: 600;
            margin-top: 15px;
            display: none;
            animation: bounce 0.5s ease;
        }
        
        .file-info {
            background: rgba(67,97,238,0.1);
            padding: 12px;
            border-radius: var(--rounded-md);
            margin-top: 15px;
            display: none;
        }
        
        .file-info span {
            display: block;
            margin-bottom: 5px;
        }
        
        .file-info .filename {
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Processing animation */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        .processing {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .processing .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(67,97,238,0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .processing p {
            color: var(--primary);
            font-weight: 600;
        }
        
        /* Completion message */
        .completion-message {
            background: rgba(76,201,240,0.1);
            border-left: 4px solid var(--success);
            padding: 15px;
            border-radius: var(--rounded-sm);
            margin: 20px 0;
            display: none;
        }
        
        .completion-message i {
            color: var(--success);
            margin-right: 10px;
        }
        
        /* Add this to your existing :root */
        :root {
            /* ... existing variables ... */
            --success-light: rgba(76,201,240,0.1);
        }
    </style>
</head>
<body>
    <!-- Previous HTML remains the same until the upload area -->
    
    <div class="upload-area" id="upload-area">
        <div class="upload-icon">
            <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <div class="upload-text">Drag & Drop your image here</div>
        <div class="upload-hint">or click to browse files (JPG, PNG, WebP - Max 10MB)</div>
        <div class="upload-success" id="upload-success">
            <i class="fas fa-check-circle"></i> File uploaded successfully!
        </div>
        <div class="file-info" id="file-info">
            <span class="filename" id="filename"></span>
            <span class="filesize" id="filesize"></span>
            <span class="filetype" id="filetype"></span>
        </div>
        <input type="file" id="file-input" accept="image/*">
    </div>
    
    <!-- Add this after the controls section -->
    <div class="processing" id="processing">
        <div class="spinner"></div>
        <p>Optimizing your image...</p>
    </div>
    
    <!-- Previous HTML remains the same until the results section -->
    
    <div class="results" id="results">
        <div class="completion-message" id="completion-message">
            <i class="fas fa-check-circle"></i>
            <span>Your image has been compressed successfully! Ready to download.</span>
        </div>
        
        <!-- Rest of your existing results HTML -->
    </div>
    
    <!-- Previous HTML remains the same until the script section -->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Previous JS remains the same until handleFileSelection
            
            // New elements
            const uploadSuccess = document.getElementById('upload-success');
            const fileInfo = document.getElementById('file-info');
            const filename = document.getElementById('filename');
            const filesize = document.getElementById('filesize');
            const filetype = document.getElementById('filetype');
            const processing = document.getElementById('processing');
            const completionMessage = document.getElementById('completion-message');
            
            // Updated handleFileSelection function
            function handleFileSelection(file) {
                // Check if file is an image
                if (!file.type.match('image.*')) {
                    alert('Please select an image file (JPG, PNG, WebP)');
                    return;
                }
                
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    alert('File size exceeds 10MB limit');
                    return;
                }
                
                originalFile = file;
                
                // Show file info
                filename.textContent = file.name;
                filesize.textContent = formatFileSize(file.size);
                filetype.textContent = file.type.split('/')[1].toUpperCase() + ' Image';
                
                // Show upload success and file info
                uploadSuccess.style.display = 'block';
                fileInfo.style.display = 'block';
                
                // Display original image
                const reader = new FileReader();
                reader.onload = function(e) {
                    originalImage.src = e.target.result;
                    
                    // Enable buttons
                    compressBtn.disabled = false;
                    resetBtn.disabled = false;
                    
                    // Update original size display
                    originalSizeElement.textContent = formatFileSize(file.size);
                };
                reader.readAsDataURL(file);
                
                // Reset results section
                resultsSection.style.display = 'none';
                completionMessage.style.display = 'none';
            }
            
            // Updated compress button event listener
            compressBtn.addEventListener('click', function() {
                if (!originalFile) return;
                
                const quality = parseInt(qualitySlider.value) / 100;
                const format = document.querySelector('input[name="format"]:checked').value;
                
                // Show processing animation
                processing.style.display = 'block';
                compressBtn.disabled = true;
                
                // Hide upload success during processing
                uploadSuccess.style.display = 'none';
                
                // Delay to allow UI to update
                setTimeout(() => {
                    compressImage(originalFile, quality, format).then(compressedBlob => {
                        compressedFileBlob = compressedBlob;
                        
                        // Hide processing animation
                        processing.style.display = 'none';
                        
                        // Display compressed image
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            compressedImage.src = e.target.result;
                            
                            // Update stats
                            const originalSize = originalFile.size;
                            const compressedSize = compressedBlob.size;
                            const reduction = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
                            
                            compressedSizeElement.textContent = formatFileSize(compressedSize);
                            reductionElement.textContent = reduction + '%';
                            
                            // Show results and completion message
                            resultsSection.style.display = 'block';
                            completionMessage.style.display = 'block';
                            
                            // Re-enable compress button
                            compressBtn.disabled = false;
                            
                            // Scroll to results
                            setTimeout(() => {
                                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }, 100);
                        };
                        reader.readAsDataURL(compressedBlob);
                    }).catch(error => {
                        console.error('Compression error:', error);
                        processing.style.display = 'none';
                        compressBtn.disabled = false;
                        alert('An error occurred during compression. Please try again.');
                    });
                }, 100);
            });
            
            // Updated reset function
            resetBtn.addEventListener('click', function() {
                originalFile = null;
                compressedFileBlob = null;
                
                // Reset UI
                originalImage.src = '';
                compressedImage.src = '';
                fileInput.value = '';
                qualitySlider.value = 80;
                qualityValue.textContent = '80';
                compressBtn.disabled = true;
                resetBtn.disabled = true;
                resultsSection.style.display = 'none';
                uploadSuccess.style.display = 'none';
                fileInfo.style.display = 'none';
                processing.style.display = 'none';
                completionMessage.style.display = 'none';
            });
            
            // Rest of your existing JS remains the same
        });
    </script>
</body>
</html>
